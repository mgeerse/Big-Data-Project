---
title: "Dashboard: Group 2 & 4"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    self_contained: FALSE
---

```{r setup, include=FALSE}
rm(list=ls(all=TRUE))

# Projectsettings
INSTALL_PACKAGES<-FALSE
if(INSTALL_PACKAGES)
{
install.packages(c("Boruta", "caTools", "corrplot", "dplyr", "e1071", "flexdashboard", "GeNetIt", "ggplot2", "gmodels", "ISLR", "lubridate", "mice", "missForest", "padr", "randomForest", "ranger", "RColorBrewer", "rpart.plot", "tidyr", "tidyverse"))
} else {
  print("#### NOTE: Package Installing is disabled. ####")
}

# Load in packages
library(foreign)
library(dplyr)
library(tidyr)
library(tidyverse)
library(padr)
library(lubridate)
library(class)
library(ggplot2)
library(caTools)
library(rpart)
library(e1071)
library(MASS)
library(gmodels)
library(ISLR)
library(rpart.plot)
library(randomForest)
library(nnet)
library(ranger)
library(Boruta)
library(mice)
library(missForest)
library(flexdashboard)
library(foreign)
library(GeNetIt)
library(ggplot2)
library(corrplot)
library(RColorBrewer)

# Set this to climatedata file name
climatedatafile<-"climatedata.csv"
climatedataperdayfile<-"climatedataperday.csv"

# Irrigation system files
irrigation_system_1<-"irrigationsystem1.csv"
irrigation_system_2<-"irrigationsystem2.csv"

# Set this to harvestdata file name
harvestdatafile<-"harvestdata.csv"

# Customfunctions

# Removes all NA's from a column then returns the mean
MeanNoNA<-function(x){
	x<-na.omit(x)
	(mean(x))
}

MedianNoNA<-function(x){
	x<-na.omit(x)
	(median(x))
}

trainBorutaModel<-function(traindata){
  boruta.train <- Boruta(freshweight~., data = na.omit(traindata), doTrace=0)
  return(boruta.train)
}

# Boruta var selection
plotVarSelection<-function(traindata){
  plot(traindata, xlab = "", xaxt = "n")
  lz<-lapply(1:ncol(traindata$ImpHistory),function(i)
    traindata$ImpHistory[is.finite(traindata$ImpHistory[,i]),i])
  names(lz) <- colnames(traindata$ImpHistory)
  Labels <- sort(sapply(lz,median))
  axis(side = 1,las=2,labels = names(Labels),
       at = 1:ncol(traindata$ImpHistory), cex.axis = 0.7)
  
  #final.boruta <- TentativeRoughFix(traindata)
  #return(final.boruta$finalDecision)
}

completeHarvestData<-function(data){
  # Set up the traindata
  traindata<-data
  
  # Introduce Missing Values Completely At Random. 0.1 staat voor afwijking
  traindata.missing <- prodNA(traindata, noNA = 0.1)
  
  # Trainen kan niet met datums, weghalen
  traindata.missing$date<-NULL
  
  # Overzicht van de missende data
  # md.pattern(traindata.missing)
  
  # De missende data seeden
  # m is het aantal booststraps, meer is langer
  # maxit aantal iteraties, meer islanger
  # method pmm = predictive mean matching, kan ook meer: https://www.rdocumentation.org/packages/mice/versions/2.25/topics/mice, scroll naar "pmm section"
  imputed_Data <- mice(traindata.missing, m=5, maxit = 10, method = 'pmm', seed = 500)
  
  # 2 staat hier voor de boostrap nr, kan 1-10 zijn
  completeData<-complete(imputed_Data,2)
  
  completeData$date<-as.Date(data$date)
  
  return(completeData)
}

ClimateData<-read.csv(climatedatafile, header = TRUE, dec = ",", fill=TRUE, sep=";", stringsAsFactors = FALSE, fileEncoding="UTF-8-BOM")
print("ClimateData loaded in.")

ClimateDataPerDay<-read.csv(climatedataperdayfile, header = TRUE, dec = ",", fill=TRUE, sep=";", stringsAsFactors = FALSE, fileEncoding="UTF-8-BOM")
print("ClimateDataPerDay loaded in.")

HarvestData<-read.csv(harvestdatafile, header = TRUE, dec = ",", fill = FALSE, sep=";", stringsAsFactors = FALSE, fileEncoding="UTF-8-BOM")
print("HarvestData loaded in.")

IrrigationData1<-read.csv(irrigation_system_1, header = TRUE, dec = ",", fill=TRUE, sep=";", stringsAsFactors = FALSE, fileEncoding="UTF-8-BOM")
print("IrrigationData1 loaded in.")

IrrigationData2<-read.csv(irrigation_system_2, header = TRUE, dec = ",", fill=TRUE, sep=";", stringsAsFactors = FALSE, fileEncoding="UTF-8-BOM")
print("IrrigationData2 loaded in.")

# This file serves to clean the data.
options(digits=9)

# Assign datatypes to HarvestData
HarvestData$plant<-as.numeric(HarvestData$Plant.number)
HarvestData$date<-as.Date(HarvestData$date,format='%d/%m/%Y')
HarvestData$truss<-as.numeric(HarvestData$Truss.number)
HarvestData$brix<-as.numeric(HarvestData$Brix..Number.)
HarvestData$diameter<-as.numeric(HarvestData$Diameter.of.fruits..mm.)
HarvestData$fruits<-as.numeric(HarvestData$Number.of.fruits..Number.)
HarvestData$weightperfruit<-as.numeric(HarvestData$Weight.per.fruit..gr.)
HarvestData$freshweight<-as.numeric(HarvestData$Fresh.weight..gr.)
HarvestData$row_number<-NULL
HarvestData$Plant.number<-NULL
HarvestData$Truss.number<-NULL
HarvestData$Brix..Number.<-NULL
HarvestData$Diameter.of.fruits..mm.<-NULL
HarvestData$Number.of.fruits..Number.<-NULL
HarvestData$Weight.per.fruit..gr.<-NULL
HarvestData$Fresh.weight..gr.<-NULL

# Assign datatypes to ClimateData
ClimateData$date<-as.Date(ClimateData$date,format='%d-%m-%Y')
print("ClimateData cleaned up.")

# Assign datatypes to ClimateDataPerDay
ClimateDataPerDay$date<-as.Date(as.character(ClimateDataPerDay$date),format='%d-%m-%Y')
print("ClimateData cleaned up.")

# Assign datatypes to IrrigationData1
IrrigationData1$date<-as.Date(as.character(IrrigationData1$date),format='%d-%m-%Y')
print("IrrigationData1 cleaned up.")

# Assign datatypes to IrrigationData2
IrrigationData2$date<-as.Date(as.character(IrrigationData2$date),format='%d-%m-%Y')
print("IrrigationData2 cleaned up.")

# Merging scipt file
# This file is made to merge klimaatdata and growth harvest data (Reformatted)

system1<-merge(ClimateDataPerDay, IrrigationData1, by.x = "date", by.y = "date")
system2<-merge(ClimateDataPerDay, IrrigationData2, by.x = "date", by.y = "date")

HarvestDataToMerge<-completeHarvestData(HarvestData)

system1<-merge(system1, HarvestDataToMerge, by.x="date", by.y="date")
system2<-merge(system2, HarvestDataToMerge, by.x="date", by.y="date")

CherryTomaat<-system2[system2$plant>=400&system2$plant<=411,]
BigTomaat<-system1[system1$plant>=300&system1$plant<=311,]
PrunaxxTomaat<-system1[system1$plant>=500&system1$plant<=511,]
SmallTomaat<-system2[system2$plant>=600&system2$plant<=611,]

BigTomaat$averageWeight<-ifelse(BigTomaat$freshweight<mean(BigTomaat$freshweight),0,1)
BigTomaat$averageWeight<-as.factor(BigTomaat$averageWeight)
levels(BigTomaat$averageWeight)<-c("Low yield", "high yield")

PrunaxxTomaat$averageWeight<-ifelse(PrunaxxTomaat$freshweight<mean(PrunaxxTomaat$freshweight),0,1)
PrunaxxTomaat$averageWeight<-as.factor(PrunaxxTomaat$averageWeight)
levels(PrunaxxTomaat$averageWeight)<-c("Low yield", "high yield")

SmallTomaat$averageWeight<-ifelse(SmallTomaat$freshweight<mean(SmallTomaat$freshweight),0,1)
SmallTomaat$averageWeight<-as.factor(SmallTomaat$averageWeight)
levels(SmallTomaat$averageWeight)<-c("Low yield", "high yield")

CherryTomaat$averageWeight<-ifelse(CherryTomaat$freshweight<mean(CherryTomaat$freshweight),0,1)
CherryTomaat$averageWeight<-as.factor(CherryTomaat$averageWeight)
levels(CherryTomaat$averageWeight)<-c("Low yield", "high yield")

```


Growth
=====================================
Column {.tabset}
-----------------------------------------------------------------------


Harvest
=====================================
```{r}

```

Climate & Irrigation
=====================================



Growth & Harvest (GH)
=====================================


GH Prediction Models
=====================================


Climate, Irrigation & Harvest (GIH)
=====================================


CIH Prediction Models
=====================================

Boruta Variable Selection
=====================================
```{r}
borutaCherryTomaat<-trainBorutaModel(CherryTomaat)
borutaBigTomaat<-trainBorutaModel(BigTomaat)
borutaPrunaxxTomaat<-trainBorutaModel(PrunaxxTomaat)
borutaSmallTomaat<-trainBorutaModel(SmallTomaat)

plotVarSelection(borutaCherryTomaat)
plotVarSelection(borutaBigTomaat)
plotVarSelection(borutaPrunaxxTomaat)
plotVarSelection(borutaSmallTomaat)
```

Corrplot
=====================================
Correlation {.tabset}
-----------------------------------------------------------------------
   
### Cherry
    
```{r}
temp<-CherryTomaat
temp$date<-NULL
temp$soort<-NULL
temp$averageWeight<-NULL
temp<-na.omit(temp)
corrplot.mixed(cor(temp), tl.pos = "lt", lower = "number", upper = "shade", number.cex=0.25, order = "AOE")
temp<-NULL
```

### Big
    
```{r}
temp<-BigTomaat
temp$date<-NULL
temp$soort<-NULL
temp$radiation.outside<-NULL
temp$averageWeight<-NULL
temp<-na.omit(temp)
corrplot.mixed(cor(temp), tl.pos = "lt", lower = "number", upper = "shade", number.cex=0.25, order = "AOE")
temp<-NULL
```

### Prunaxx
    
```{r}
temp<-PrunaxxTomaat
temp$date<-NULL
temp$soort<-NULL
temp$averageWeight<-NULL
temp<-na.omit(temp)
corrplot.mixed(cor(temp), tl.pos = "lt", lower = "number", upper = "shade", number.cex=0.25, order = "AOE")
temp<-NULL
```

### Small
    
```{r}
temp<-SmallTomaat
temp$date<-NULL
temp$soort<-NULL
temp$averageWeight<-NULL
temp<-na.omit(temp)
corrplot.mixed(cor(temp), tl.pos = "lt", lower = "number", upper = "shade", number.cex=0.25, order = "AOE")
temp<-NULL
```

LDA
=====================================
```{r}
# model_LDA = lda(freshweight~., data  = trainingData1)
# print(model_LDA)
```
QDA
=====================================
```{r}
# model_QDA = qda(freshweight~., data = trainingData1)
# print(model_QDA)
```
K Nearest
=====================================

knn {.tabset}
-----------------------------------------------------------------------
### Cherry
    
```{r}
# test data:
testData<-CherryTomaat[1:120, ]
testData$date<-NULL
testData$averageWeight<-NULL


# train data:
trainData<-SmallTomaat[120:165,]
trainData$date<-NULL
trainData$averageWeight<-NULL

train_labels<-SmallTomaat[120:165,15]
train_test_category <- SmallTomaat[-120,15]

temp<-knn(test = na.omit(testData), train = na.omit(trainData), k = 10, cl = na.omit(train_labels))

```

### Big
    
```{r}
# test data:
testData<-BigTomaat[1:60,]
testData$date<-NULL
testData$averageWeight<-NULL
testData$radiation.outside<-NULL


# train data:
trainData<-BigTomaat[60:80,]
trainData$date<-NULL
trainData$averageWeight<-NULL
trainData$radiation.outside<-NULL

train_labels<-BigTomaat[60:80,15]
train_test_category <- BigTomaat[-80,15]

temp<-knn(test = testData, train = trainData, k = 10, cl = train_labels)

#table(train_test_category,temp)
```

### Prunaxx
    
```{r}
# test data:
testData<-PrunaxxTomaat[1:60, ]
testData$date<-NULL
testData$averageWeight<-NULL
testData$radiation.outside<-NULL


# train data:
trainData<-PrunaxxTomaat[60:83,]
trainData$date<-NULL
trainData$averageWeight<-NULL
trainData$radiation.outside<-NULL

train_labels<-PrunaxxTomaat[60:83,15]
train_test_category <- PrunaxxTomaat[-60,15]

temp<-knn(test = testData, train = trainData, k = 10, cl = train_labels)

#table(train_test_category,temp)
```

### Small
    
```{r}
# test data:
<<<<<<< HEAD
testData<-SmallTomaat[1:110, ]

testData$date<-NULL
testData$averageWeight<-NULL
testData$radiation.outside<-NULL

# train data:
trainData<-SmallTomaat[110:137,]
trainData$date<-NULL
trainData$averageWeight<-NULL
trainData$radiation.outside<-NULL

train_labels<-SmallTomaat[110:137,15]
train_test_category <- SmallTomaat[-110,15]
=======
#testData<-trainingData1[1:199, ]
#testData$date<-NULL
# train data:
#trainData<-trainingData1[200:295,]
#trainData$date<-NULL

#train_labels<-trainingData1[200:295,15]
#train_test_category <- trainingData1[-200,15]
>>>>>>> ca63813daf6eda2865f7930bb780d703a97481fd

#temp<-knn(test = testData, train = trainData, k = 10, cl = train_labels)

#table(train_test_category,temp)

```
Random Forest
=====================================
```{r}

```